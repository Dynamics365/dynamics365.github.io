<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="noodp"/><title>Develop custom Data Entities for Dual-write | </title><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content=""/>
<meta name="twitter:title" content="Develop custom Data Entities for Dual-write"/>
<meta name="twitter:description" content=""/><meta name="Description" content="Dynamics 365 Finance Operations | Power Platform"><meta property="og:title" content="Develop custom Data Entities for Dual-write" />
<meta property="og:description" content="Dual-write has been around for almost two years now. It‚Äôs one of the ways of integrating Dynamics 365 Finance and Operations and Dataverse along with Virtual Entities.
The standard solution comes with many out-of-the-box entities available to synchronize. This has been one of the great improvements since Dual-write was made available in preview, when Juanan and I demoed it in the 2019 Dynamics Saturday in Madrid.
Develop custom Data Entities for Dual-write 1" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nuxulu.com/2021-05-02-develop-custom-data-entities-for-dual-write/" /><meta property="og:image" content="https://nuxulu.com/Icon/mstile-150x150.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-02T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-05-02T00:00:00&#43;00:00" />

<meta name="application-name" content="Finance Operations | Power Platform">
<meta name="apple-mobile-web-app-title" content="Finance Operations | Power Platform"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/Icon/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://nuxulu.com/2021-05-02-develop-custom-data-entities-for-dual-write/" /><script data-ad-client="pub-3534873375492458" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><meta name="google-site-verification" content="f08c47fec0942fa0" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Develop custom Data Entities for Dual-write",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/nuxulu.com\/2021-05-02-develop-custom-data-entities-for-dual-write\/"
        },"genre": "posts","keywords": "Dynamics 365 Finance, Dynamics 365 Supply Chain Management, Dynamics 365 Commerce, Dual-write, ALM, Data Entities","wordCount":  1135 ,
        "url": "https:\/\/nuxulu.com\/2021-05-02-develop-custom-data-entities-for-dual-write\/","datePublished": "2021-05-02T00:00:00+00:00","dateModified": "2021-05-02T00:00:00+00:00",
        "publisher": {
            "@type": "Person",
            "name": "", "image": [
            {
            "@type": "ImageObject",
            "url": "\/images\/MaxN_Avatar.png"
            }
            ]},"author": {
                "@type": "Person",
                "name": ""
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header>
    <div class="desktop header" id="header-desktop">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Dynamics 365 &amp; Power Platform | NUXULU" class="header-logo logo-svg"><img loading="lazy" decoding="async"
         class="logo"
         src="/Icon/favicon-32x32.png"
         alt="/Icon/favicon-32x32.png"
         title="/Icon/favicon-32x32.png"
    /><span class="header-title-pre">  </span>Finance Operations &amp; Power Platform Archive</a>
            </div>
            <div class="menu">
                <nav>
                    <h2 class="display-hidden">–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è</h2>
                    <ul class="menu-inner"><li>
                            <a class="menu-item" href="/posts/"> Posts </a>
                        </li><li>
                            <a class="menu-item" href="/tags/"> Tags </a>
                        </li><li>
                            <a class="menu-item" href="/categories/"> Categories </a>
                        </li><li>
                            <a class="menu-item" href="/about/"> About </a>
                        </li></ul>
                </nav><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <span class="svg-icon icon-search"></span>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <span class="svg-icon icon-cancel"></span>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <span class="svg-icon icon-loading"></span>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <span class="svg-icon icon-moon"></span>
                </a>
            </div>
        </div>
    </div><div class="mobile header" id="header-mobile">
        <div class="header-container">
            <div class="header-wrapper">
                <div class="header-title">
                    <a href="/" title="Dynamics 365 &amp; Power Platform | NUXULU" class="header-logo"><img loading="lazy" decoding="async"
         class="logo"
         src="/Icon/favicon-32x32.png"
         alt="/Icon/favicon-32x32.png"
         title="/Icon/favicon-32x32.png"
    /><span class="header-title-pre">  </span>Finance Operations &amp; Power Platform Archive</a>
                </div>
                <div class="menu-toggle" id="menu-toggle-mobile">
                    <span></span><span></span><span></span>
                </div>
            </div>
            <div class="menu" id="menu-mobile"><div class="search-wrapper">
                        <div class="search mobile" id="search-mobile">
                            <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                                <span class="svg-icon icon-search"></span>
                            </a>
                            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                                <span class="svg-icon icon-cancel"></span>
                            </a>
                            <span class="search-button search-loading" id="search-loading-mobile">
                                <span class="svg-icon icon-loading"></span>
                            </span>
                        </div>
                        <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                            Cancel
                        </a>
                    </div><nav>
                    <h2 class="display-hidden">–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è</h2>
                    <ul><li>
                            <a class="menu-item" href="/posts/" title="">Posts</a>
                        </li><li>
                            <a class="menu-item" href="/tags/" title="">Tags</a>
                        </li><li>
                            <a class="menu-item" href="/categories/" title="">Categories</a>
                        </li><li>
                            <a class="menu-item" href="/about/" title="">About</a>
                        </li></ul>
                </nav>
                <a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <span class="svg-icon icon-moon"></span>
                </a></div>
        </div>
    </div><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div></header><main class="main">
<div class="container content-article page-toc theme-classic"><div class="toc" id="toc-auto">
            <div class="toc-title">Contents</div>
            <div class="toc-content" id="toc-content-auto"></div>
        </div>
    

    
    
    <article>
    

        <header class="header-post">

            

            
            <div class="post-title">

                    <div class="post-all-meta">
                        <nav class="breadcrumbs">
    <ol>
        <li><a href="/">Home </a></li><li>Develop custom Data Entities for Dual-write</li>
    </ol>
</nav>
                        <h1 class="single-title flipInX">Develop custom Data Entities for Dual-write</h1><div class="post-meta summary-post-meta"><span class="post-meta-date meta-item">
                                <span class="svg-icon icon-clock"></span><time class="timeago" datetime="2021-05-02">May 2, 2021</time>
                            </span><span class="post-meta-words meta-item">
                                <span class="svg-icon icon-pencil"></span>1135 words
                            </span>
                            <span class="post-meta-reading meta-item">
                                <span class="svg-icon icon-stopwatch"></span>6 minutes
                            </span>
                        </div>

                    </div>

                </div>

                </header>

        <div class="article-post toc-start">

            <div class="content-block content-block-first content-block-position">

                <div class="post single"><div class="details toc" id="toc-static"  data-kept="">
                        <div class="details-summary toc-title">
                            <span>Contents</span>
                        </div>
                        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#httpsaristeinfoen202103develop-custom-data-entities-dual-writedual-writedual-write"><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#dual-write"></a>Dual-write</a></li>
    <li><a href="#httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-the-data-entitycreate-the-data-entity"><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-the-data-entity"></a>Create the Data-entity</a></li>
    <li><a href="#httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-a-table-in-dataversecreate-a-table-in-dataverse"><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-a-table-in-dataverse"></a>Create a table in Dataverse</a></li>
    <li><a href="#httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-table-mapcreate-table-map"><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-table-map"></a>Create table map</a></li>
    <li><a href="#httpsaristeinfoen202103develop-custom-data-entities-dual-writeintegration-keyintegration-key"><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#integration-key"></a>Integration key</a></li>
    <li><a href="#httpsaristeinfoen202103develop-custom-data-entities-dual-writeactionaction"><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#action"></a>Action!</a></li>
  </ul>
</nav></div>
                    </div><p><a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/dual-write-home-page?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreffer">Dual-write</a> has been around for almost two years now. It‚Äôs one of the ways of <strong>integrating Dynamics 365 Finance and Operations and <a href="https://docs.microsoft.com/en-us/powerapps/maker/data-platform?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreffer">Dataverse</a></strong> along with <a href="https://ariste.info/en/2020/09/dynamics-365-odata-cds-virtual-entities/" target="_blank" rel="noopener noreffer">Virtual Entities</a>.</p>
<p>The standard solution comes with many <strong>out-of-the-box entities</strong> available to synchronize. This has been one of the great improvements since Dual-write was made available in preview, when <a href="https://jatomas.com/" target="_blank" rel="noopener noreffer">Juanan</a> and I <a href="https://www.youtube.com/watch?v=z_dLGDF7Ci0" target="_blank" rel="noopener noreffer">demoed it in the 2019 Dynamics Saturday in Madrid</a>.</p>
<p>




<figure class="render-image"><a target="_blank" href="https://static.ariste.info/wp-content/uploads/2021/03/DW-1024x1024.png#center" title="Develop custom Data Entities for Dual-write 1" >
        <img loading="lazy" decoding="async"
             class="render-image"
             src="https://static.ariste.info/wp-content/uploads/2021/03/DW-1024x1024.png#center"
            alt="Dual write"
        />
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 1</figcaption>
</figure></p>
<p>This is how Dual write really works</p>
<p>But what if we need to develop a <strong>new custom Data Entity in MSDyn365FO</strong> and use it in Dual-write? It‚Äôs easy but there‚Äôs some things we need to remember when doing it.</p>
<h2 id="httpsaristeinfoen202103develop-custom-data-entities-dual-writedual-writedual-write" class="headerLink"><a href="#httpsaristeinfoen202103develop-custom-data-entities-dual-writedual-writedual-write" class="header-mark"></a><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#dual-write" target="_blank" rel="noopener noreffer"></a>Dual-write</h2><p><a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/dual-write-home-page?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreffer">Dual-write</a> is a bidirectional integration that will synchronously write in Dataverse when data is created, updated or deleted in MSDyn365FO in near-real-time. On the Finance and Operations side it uses data entities to export data to Dataverse.</p>
<p>Right now there‚Äôs a set of several OOB entities that come ready to be synchronized, and thanks to <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/initial-sync-guidance?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreffer">Initial Sync</a> we can populate data in Dataverse choosing FnO as the source when starting the sync, or also choose Dataverse as the source.</p>
<p>If you want to learn more about Dual-write you can:</p>
<ul>
<li>Read <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/dual-write-home-page?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreffer">the docs</a> which have plenty of information. <strong>Read the docs</strong>. Always.</li>
<li><a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/connection-setup?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreffer">Guidance for Dual-Write setup</a></li>
<li><a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/requirements-and-prerequisites?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreffer">System requirements and prerequisites</a></li>
<li>Watch some of <a href="https://daxture.blogspot.com/" target="_blank" rel="noopener noreffer">Faisal Fareed</a>‚Äòs sessions about Dual-write: <a href="https://dynamicscon.com/" target="_blank" rel="noopener noreffer">DynamicsCon</a> 2020: <a href="https://www.youtube.com/watch?v=DbyLLQswM5o" target="_blank" rel="noopener noreffer">The Power of Dual-write</a> or Scottish Summit 2021: <a href="https://www.youtube.com/watch?v=O2iuM6dWklI" target="_blank" rel="noopener noreffer">D365 FO integration with Dataverse ‚Äì Dual write, Virtual Entities, OR Data Integrator</a>. He‚Äôs got some more which you can find on Youtube.</li>
</ul>
<h2 id="httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-the-data-entitycreate-the-data-entity" class="headerLink"><a href="#httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-the-data-entitycreate-the-data-entity" class="header-mark"></a><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-the-data-entity" target="_blank" rel="noopener noreffer"></a>Create the Data-entity</h2><p>In Visual Studio we need to create the entity from our table. I‚Äôve created a new table called AASBookTable with just four fields: BookId, Author, Name and ISBN. Its primary key is the BookId field which is also its <strong>alternate key</strong> and will be used as natural key in the entity.</p>
<p>Next, we create the data entity and make sure we‚Äôre marking the ‚Äú<strong>Enable data management capabilities</strong>‚Äù checkbox:</p>
<p>




<figure class="render-image"><a target="_blank" href="https://static.ariste.info/wp-content/uploads/2021/03/DW1.png#center" title="Develop custom Data Entities for Dual-write 2" >
        <img loading="lazy" decoding="async"
             class="render-image"
             src="https://static.ariste.info/wp-content/uploads/2021/03/DW1.png#center"
            alt="Dynamics 365 Finance and Operations Data entity wizard"
        />
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 2</figcaption>
</figure></p>
<p>Enable data management capabilities must be checked</p>
<p>If the entity doesn‚Äôt have data management enabled it won‚Äôt be displayed in the list in the Dual-write tables setup.</p>
<h2 id="httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-a-table-in-dataversecreate-a-table-in-dataverse" class="headerLink"><a href="#httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-a-table-in-dataversecreate-a-table-in-dataverse" class="header-mark"></a><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-a-table-in-dataverse" target="_blank" rel="noopener noreffer"></a>Create a table in Dataverse</h2><p>Now we need to create a table in our Dataverse environment. This table must have at least some of the fields we want to synchronize to Dataverse <strong>AND</strong> a company field. <strong>The <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/company-data?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreffer">company</a> concept doesn‚Äôt exist in Dataverse/CRM</strong> but thanks to the OOB mappings and <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/initial-sync-guidance?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreffer">Initial Sync</a> we can solve this with just a few clicks and will have a company table in Dataverse with all our FnO legal entities.</p>
<p>




<figure class="render-image"><a target="_blank" href="https://static.ariste.info/wp-content/uploads/2021/03/DW2.png#center" title="Develop custom Data Entities for Dual-write 3" >
        <img loading="lazy" decoding="async"
             class="render-image"
             src="https://static.ariste.info/wp-content/uploads/2021/03/DW2.png#center"
            alt="Company field related to table company"
        />
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 3</figcaption>
</figure></p>
<p>Company field related to table company</p>
<p>Following my example I‚Äôve created a table with the same four fields and a company field with the <strong>data type Lookup</strong> and its related table Company, where the FnO legal entities are synchronized.</p>
<p>As I said, if we don‚Äôt create this field we won-t be able to setup Dual-write for this table.</p>
<h2 id="httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-table-mapcreate-table-map" class="headerLink"><a href="#httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-table-mapcreate-table-map" class="header-mark"></a><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-table-map" target="_blank" rel="noopener noreffer"></a>Create table map</h2><p>Our table and data entity are ready, and now <strong>we need to <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/enable-entity-map?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreffer">create a mapping</a> between them</strong> in the Dual-write workspace in FnO. Click the ‚ÄúAdd table map‚Äù button:</p>
<p>




<figure class="render-image"><a target="_blank" href="https://static.ariste.info/wp-content/uploads/2021/03/DW3.png#center" title="Develop custom Data Entities for Dual-write 4" >
        <img loading="lazy" decoding="async"
             class="render-image"
             src="https://static.ariste.info/wp-content/uploads/2021/03/DW3.png#center"
            alt="Dynamics 365 Dual-write add table map"
        />
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 4</figcaption>
</figure></p>
<p>Dynamics 365 Dual-write add table map</p>
<p>A new dialog will open and we need to select the FnO entity and the Dataverse table:</p>
<p>




<figure class="render-image"><a target="_blank" href="https://static.ariste.info/wp-content/uploads/2021/03/DW4-edited.png#center" title="Develop custom Data Entities for Dual-write 5" >
        <img loading="lazy" decoding="async"
             class="render-image"
             src="https://static.ariste.info/wp-content/uploads/2021/03/DW4-edited.png#center"
            alt="Entity map"
        />
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 5</figcaption>
</figure></p>
<p>Entity map</p>
<p>Select the entity and table we‚Äôve created and click save. Then we can define the field mapping:</p>
<p>




<figure class="render-image"><a target="_blank" href="https://static.ariste.info/wp-content/uploads/2021/03/DW13-1024x629.png#center" title="Develop custom Data Entities for Dual-write 6" >
        <img loading="lazy" decoding="async"
             class="render-image"
             src="https://static.ariste.info/wp-content/uploads/2021/03/DW13-1024x629.png#center"
            alt="Dynamics 365 Dual-write field maps"
        />
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 6</figcaption>
</figure></p>
<p>Dynamics 365 Dual-write field maps</p>
<p>Because I‚Äôve created both it‚Äôs clear what to map. And after doing this we can click save and it‚Äôs done, right? No! <strong>WRONG</strong>! If we do just this we‚Äôll get an error, this error:</p>
<blockquote>
<p>Project validation failed. SourceEntitySchema: Books has a primaryCompanyField set to DataAreaId and DestinationEntitySchema: cr008_bookses doesn‚Äôt have primary company field set. Dual-write only supports mapping between cross-company entities or company-specific entities from both sides..keys are missing for either AX or CRM.keys are missing for either CRM or AX</p>
</blockquote>
<p>Or we can also get an error regarding a missing integration key for the company field. In the end both are caused because <strong>we‚Äôve missed defining the integration key</strong> for this new Dataverse table:</p>
<h2 id="httpsaristeinfoen202103develop-custom-data-entities-dual-writeintegration-keyintegration-key" class="headerLink"><a href="#httpsaristeinfoen202103develop-custom-data-entities-dual-writeintegration-keyintegration-key" class="header-mark"></a><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#integration-key" target="_blank" rel="noopener noreffer"></a>Integration key</h2><p>Go back to the main Dual-write form and click on the ‚ÄúIntegration key‚Äù button:</p>
<p>




<figure class="render-image"><a target="_blank" href="https://static.ariste.info/wp-content/uploads/2021/03/DW7.png#center" title="Develop custom Data Entities for Dual-write 7" >
        <img loading="lazy" decoding="async"
             class="render-image"
             src="https://static.ariste.info/wp-content/uploads/2021/03/DW7.png#center"
            alt="Dual/write integration key"
        />
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 7</figcaption>
</figure></p>
<p>Dual-write integration key</p>
<p>The integration key will be <strong>the same as the FnO data entity key, plus the company</strong> if your data entity has a company context. Remember that when we create indexes in FnO the DataAreaId field isn‚Äôt included in the field, but it is in the SQL Server index along the partition field.</p>
<p>The integration key for our custom Dual-write mapping will look like this:</p>
<p>




<figure class="render-image"><a target="_blank" href="https://static.ariste.info/wp-content/uploads/2021/03/DW11.png#center" title="Develop custom Data Entities for Dual-write 8" >
        <img loading="lazy" decoding="async"
             class="render-image"
             src="https://static.ariste.info/wp-content/uploads/2021/03/DW11.png#center"
            alt="Dual/write integration key"
        />
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 8</figcaption>
</figure></p>
<p>Dual/write integration key</p>
<p>Remember we‚Äôve added the company field to our Dataverse table? You can see in the image above that the field includes the relation to the Company table in Dataverse. We won‚Äôt be able to save the field mapping if we create the key using our Dataverse table‚Äôs company field instead of its Company table relation, like this:</p>
<p>




<figure class="render-image"><a target="_blank" href="https://static.ariste.info/wp-content/uploads/2021/03/DW9.png#center" title="Develop custom Data Entities for Dual-write 9" >
        <img loading="lazy" decoding="async"
             class="render-image"
             src="https://static.ariste.info/wp-content/uploads/2021/03/DW9.png#center"
            alt="Dual/write integration key"
        />
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 9</figcaption>
</figure></p>
<p>Dual/write integration key</p>
<p>See the difference? In the first image the field reads <em>c008_company.cdm_companycode</em> while in the second one it‚Äôs <em>c008_company</em>. If we set the integration key using the field in our table instead of the related table and save the fields‚Äô mapping we‚Äôll get an error saying the company is missing in the key because it‚Äôs expecting the relation!</p>
<h2 id="httpsaristeinfoen202103develop-custom-data-entities-dual-writeactionaction" class="headerLink"><a href="#httpsaristeinfoen202103develop-custom-data-entities-dual-writeactionaction" class="header-mark"></a><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#action" target="_blank" rel="noopener noreffer"></a>Action!</h2><p>The table and field mappings are ready, just click run and go create a new book in the FnO form:</p>
<p>




<figure class="render-image"><a target="_blank" href="https://static.ariste.info/wp-content/uploads/2021/03/DW14.png#center" title="Develop custom Data Entities for Dual-write 10" >
        <img loading="lazy" decoding="async"
             class="render-image"
             src="https://static.ariste.info/wp-content/uploads/2021/03/DW14.png#center"
            alt="Finance and Operations form"
        />
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 10</figcaption>
</figure></p>
<p>Finance and Operations form</p>
<p>Then we go to our Dataverse table and check its data‚Ä¶</p>
<p>




<figure class="render-image"><a target="_blank" href="https://static.ariste.info/wp-content/uploads/2021/03/DW15.png#center" title="Develop custom Data Entities for Dual-write 11" >
        <img loading="lazy" decoding="async"
             class="render-image"
             src="https://static.ariste.info/wp-content/uploads/2021/03/DW15.png#center"
            alt="Dataverse table data"
        />
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 11</figcaption>
</figure></p>
<p>Dataverse table data</p>
<p>It‚Äôs there! And of course it‚Äôs working in both directions. If I create a record in Dataverse it‚Äôll be created in FnO too. I‚Äôll use the Excel add-in to add a new book:</p>
<p>




<figure class="render-image"><a target="_blank" href="https://static.ariste.info/wp-content/uploads/2021/03/DW16.png#center" title="Develop custom Data Entities for Dual-write 12" >
        <img loading="lazy" decoding="async"
             class="render-image"
             src="https://static.ariste.info/wp-content/uploads/2021/03/DW16.png#center"
            alt="Dataverse Excel add-in"
        />
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 12</figcaption>
</figure></p>
<p>Dataverse Excel add-in</p>
<p>And after refreshing the form in FnO we can see it there too:</p>
<p>




<figure class="render-image"><a target="_blank" href="https://static.ariste.info/wp-content/uploads/2021/03/DW17.png#center" title="Develop custom Data Entities for Dual-write 13" >
        <img loading="lazy" decoding="async"
             class="render-image"
             src="https://static.ariste.info/wp-content/uploads/2021/03/DW17.png#center"
            alt="Develop custom Data Entities for Dual-write 1"
        />
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 13</figcaption>
</figure></p>
<p>This is a really simple example of how we can create a custom table, use it in a data entity and then use this entity in our dual-write setup. It‚Äôs something that can be easily done but we need to <strong>remember the ‚Äúcompany thing‚Äù</strong>, otherwise this will never work!</p>
<p>Dual-write is even easier to configure nowadays thanks to <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/lcs-setup?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreffer">LCS allowing us to create and link a new Dataverse environment when we deploy a new Finance and Operations environment</a>.</p>
</div><footer>
                        <div class="post">


<div class="post-share"><div class="share-link">
        <a class="share-icon share-twitter" href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://nuxulu.com/2021-05-02-develop-custom-data-entities-for-dual-write/" data-title="Develop custom Data Entities for Dual-write" data-hashtags="Dynamics 365 Finance,Dynamics 365 Supply Chain Management,Dynamics 365 Commerce,Dual-write,ALM,Data Entities"><span class="svg-social-icon icon-twitter"></span></a>
    </div><div class="share-link">
        <a class="share-icon share-facebook" href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://nuxulu.com/2021-05-02-develop-custom-data-entities-for-dual-write/" data-hashtag="Dynamics 365 Finance"><span class="svg-social-icon icon-facebook"></span></a>
    </div></div>

<div class="footer-post-author">
    <div class="author-avatar"><a href="https://nuxulu.com/about" target="_blank"><img alt="Trusted user pc" src="/images/MaxN_Avatar.png"></a></div>
    <div class="author-info">
        <div class="name"><a href="https://nuxulu.com/about" target="_blank"></a></div>
        <div class="number-posts">Trusted user pc</span></div>
    </div>
</div><div class="post-tags"><a href="/tags/dynamics-365-finance/" class="tag">Dynamics 365 Finance</a><a href="/tags/dynamics-365-supply-chain-management/" class="tag">Dynamics 365 Supply Chain Management</a><a href="/tags/dynamics-365-commerce/" class="tag">Dynamics 365 Commerce</a><a href="/tags/dual-write/" class="tag">Dual-write</a><a href="/tags/alm/" class="tag">ALM</a><a href="/tags/data-entities/" class="tag">Data Entities</a></div></div>
                </footer></div>
        <div id="toc-final"></div>
        </div>

    
    </article>
    <aside class=article-post>
    <div class="content-block content-block-position block-donate">
        <div class=post>
            <div class=title>
                <div style=text-align:center;>
                    <svg width="90" height="90" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path fill="#fff"
                            d="M376 30c-27.783.0-53.255 8.804-75.707 26.168-21.525 16.647-35.856 37.85-44.293 53.268-8.437-15.419-22.768-36.621-44.293-53.268C189.255 38.804 163.783 30 136 30 58.468 30 0 93.417.0 177.514c0 90.854 72.943 153.015 183.369 247.118l62.099 53.414C248.38 480.596 252.12 482 256 482s7.62-1.404 10.532-3.953l62.111-53.425C439.057 330.529 512 268.368 512 177.514 512 93.417 453.532 30 376 30z" />
                    </svg>
                </div>
                <div style=text-align:center;margin-top:20px>
                    <span class=title>If any of my work was helpful, you can:</span>
                </div>
            </div>
            <div class=donate-text>
                <ul>
                    <li>‚úâÔ∏è Share this post with your colleagues</li>
                    <li>üí¨ Comment, ask questions and report any issues/typos found</li>
                    <li>(‚òûÔæü„ÉÆÔæü)‚òû Buy me a coffee</li>
                </ul>
            </div>
            <div class=donate-button><a href=https://www.buymeacoffee.com/maxnguyen
                    class="button button-big button-white">Donate</a>
            </div>
        </div>
    </div>
</aside><section class="page single comments content-block-position">
        <h1 class="display-hidden">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h1><div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></section></div>

</main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Have a nice day!</div><div class="footer-line"><i class="svg-icon icon-copyright"></i><span>2013 - 2021</span><span class="author">&nbsp;<a href="https://nuxulu.com/about" target="_blank">Max</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <aside id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="svg-icon icon-arrow-up"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="svg-icon icon-comments-fixed"></i>
            </a>
        </aside><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="/drawio.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js"></script><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js"></script><script>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":30},"comment":{"gitalk":{"admin":["Dynamics365"],"clientID":"19dae9933700b3a75676","clientSecret":"bd7c0c7ebf94cb229204e36d0113f2560d48c942","id":"2021-05-02T00:00:00Z","owner":"Dynamics365","repo":"gittalk","title":"Develop custom Data Entities for Dual-write"}},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script src="/js/theme.min.js"></script><script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

	        ga('create', 'UA-57379422-3', 'auto');
	        ga('set', 'anonymizeIp', true);
	        ga('send', 'pageview');
	    </script></body>
</html>
