<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="noodp"/><title>Consuming Dynamics 365 Finance and Operations OData services from .NET | </title><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content=""/>
<meta name="twitter:title" content="Consuming Dynamics 365 Finance and Operations OData services from .NET"/>
<meta name="twitter:description" content=""/><meta name="Description" content="Dynamics 365 Finance &amp; Operations and Power Platform"><meta property="og:title" content="Consuming Dynamics 365 Finance and Operations OData services from .NET" />
<meta property="og:description" content="1. Authentication We need an authentication to connect Dynamics 365 finance and operations from .Net application by using service principal.
How to create an app registration in Azure https://docs.microsoft.com/en-us/azure/active-directory/develop/app-registrations-training-guide-for-app-registrations-legacy-users
You also need to add required permissions for Dynamics 365 finance and operations, please follow
https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/services-home-page#register-a-web-application-with-aad
This is what you should have
 {:.border}
2. Register your external application a. In the FinOps application, go to System administration &gt; Setup &gt; Azure Active Directory applications." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nuxulu.com/2019-12-16-consuming-dynamics-365-finance-and-operations-odata-services-from-net/" /><meta property="og:image" content="https://nuxulu.com/Icon/mstile-150x150.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-12-16T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2019-12-16T00:00:00&#43;00:00" />

<meta name="application-name" content="UBlogger">
<meta name="apple-mobile-web-app-title" content="UBlogger"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/Icon/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://nuxulu.com/2019-12-16-consuming-dynamics-365-finance-and-operations-odata-services-from-net/" /><script data-ad-client="pub-3534873375492458" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><meta name="google-site-verification" content="f08c47fec0942fa0" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Consuming Dynamics 365 Finance and Operations OData services from .NET",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/nuxulu.com\/2019-12-16-consuming-dynamics-365-finance-and-operations-odata-services-from-net\/"
        },"genre": "posts","keywords": "Postman, OData, BATCH, integration, .NET","wordCount":  613 ,
        "url": "https:\/\/nuxulu.com\/2019-12-16-consuming-dynamics-365-finance-and-operations-odata-services-from-net\/","datePublished": "2019-12-16T00:00:00+00:00","dateModified": "2019-12-16T00:00:00+00:00","description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Dynamics 365 &amp; Power Platform | NUXULU" class="header-logo logo-svg"><img loading="lazy" decoding="async"
         src="/Icon/favicon-32x32.png"
         alt="/Icon/favicon-32x32.png"
         title="/Icon/favicon-32x32.png"
    />Finance Operations &amp; Power Platform Archive</a>
        </div>
        <div class="menu">
            <nav>
                <ul class="menu-inner"><li>
                        <a class="menu-item" href="/posts/"> Posts </a>
                    </li><li>
                        <a class="menu-item" href="/tags/"> Tags </a>
                    </li><li>
                        <a class="menu-item" href="/categories/"> Categories </a>
                    </li><li>
                        <a class="menu-item" href="/about/"> About </a>
                    </li></ul>
            </nav><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <span class="svg-icon icon-search"></span>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <span class="svg-icon icon-cancel"></span>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <span class="svg-icon icon-loading"></span>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <span class="svg-icon icon-moon"></span>
                </a>
            </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Dynamics 365 &amp; Power Platform | NUXULU" class="header-logo"><img loading="lazy" decoding="async"
         src="/Icon/favicon-32x32.png"
         alt="/Icon/favicon-32x32.png"
         title="/Icon/favicon-32x32.png"
    />Finance Operations &amp; Power Platform Archive</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <span class="svg-icon icon-search"></span>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <span class="svg-icon icon-cancel"></span>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <span class="svg-icon icon-loading"></span>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><nav>
                <ul><li>
                        <a class="menu-item" href="/posts/" title="">Posts</a>
                    </li><li>
                        <a class="menu-item" href="/tags/" title="">Tags</a>
                    </li><li>
                        <a class="menu-item" href="/categories/" title="">Categories</a>
                    </li><li>
                        <a class="menu-item" href="/about/" title="">About</a>
                    </li></ul>
            </nav>
            <a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <span class="svg-icon icon-moon"></span>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div><main class="main">
<div class="container content-article page-toc theme-classic"><div class="toc" id="toc-auto">
            <div class="toc-title">Contents</div>
            <div class="toc-content" id="toc-content-auto"></div>
        </div>

    <div class="header-post">

        

        
        <div class="post-title">

                <div class="post-all-meta">
                    <nav class="breadcrumbs">
    <ol>
        <li><a href="/">Home </a></li><li>Consuming Dynamics 365 Finance and Operations OData services from .NET</li>
    </ol>
</nav>
                    <h1 class="single-title flipInX">Consuming Dynamics 365 Finance and Operations OData services from .NET</h1><div class="post-meta">
                        <div class="post-meta-line"><span class="post-meta-date">
                                <i class="svg-icon icon-clock"></i><time class="timeago" datetime="2019-12-16">December 16, 2019</time>
                            </span><span class="post-meta-words">
                                <i class="svg-icon icon-pencil"></i>613 words
                            </span>
                            <span class="post-meta-reading">
                                <i class="svg-icon icon-stopwatch"></i>3 minutes
                            </span>
                        </div>
                    </div>
                </div>

            </div>

            </div>

    <article class="single toc-start">

        <div class="content-block content-block-first content-block-position">

        <div class="post"><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#a-in-the-finops-application-go-to-system-administration--setup--azure-active-directory-applications">a. In the FinOps application, go to <strong>System administration &gt; Setup &gt; Azure Active Directory applications</strong>.</a></li>
        <li><a href="#bselect-new">b.	Select <strong>New</strong>.</a></li>
        <li><a href="#cfill-in-the-fields-for-the-new-record">c.	Fill in the fields for the new record:</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#a-using-temporary-file">a. Using temporary file</a></li>
        <li><a href="#b-remove-unused-entities">b. Remove unused entities</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><h1 id="1-authentication">1. Authentication</h1>
<p>We need an authentication to connect Dynamics 365 finance and operations from .Net application by using service principal.</p>
<p>How to create an app registration in Azure <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/app-registrations-training-guide-for-app-registrations-legacy-users" target="_blank" rel="noopener noreffer">https://docs.microsoft.com/en-us/azure/active-directory/develop/app-registrations-training-guide-for-app-registrations-legacy-users</a></p>
<p>You also need to add required permissions for Dynamics 365 finance and operations, please follow<br>
<a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/services-home-page#register-a-web-application-with-aad" target="_blank" rel="noopener noreffer">https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/services-home-page#register-a-web-application-with-aad</a></p>
<p>This is what you should have</p>
<p>




<img loading="lazy" decoding="async"
         src="/imagesposts/Consuming-Dynamics-365-Finance-and-Operations-OData-services-from-NET_1.png#center"
         alt="Image"
         title="Consuming-Dynamics-365-Finance-and-Operations-OData-services-from-NET_1.png#center"
    />{:.border}</p>
<h1 id="2-register-your-external-application">2. Register your external application</h1>
<h3 id="a-in-the-finops-application-go-to-system-administration--setup--azure-active-directory-applications">a. In the FinOps application, go to <strong>System administration &gt; Setup &gt; Azure Active Directory applications</strong>.</h3>
<h3 id="bselect-new">b.	Select <strong>New</strong>.</h3>
<h3 id="cfill-in-the-fields-for-the-new-record">c.	Fill in the fields for the new record:</h3>
<ul>
<li>In the <strong>Client Id</strong> field, enter the application ID that you registered in Azure AD.</li>
<li>In the <strong>Name field</strong>, enter a name for the application.</li>
<li>In the <strong>User ID field</strong>, select an appropriate service account user ID. For this example, we have selected the Admin user. However, as a better practice, you should provision a dedicated service account that has the correct permissions for the operations that must be performed. When you&rsquo;ve finished, select <strong>Save</strong>.</li>
</ul>
<p>You&rsquo;ve now finished setting up the prerequisites. After the external application retrieves an Azure AD authentication token, it should now be able to use the token in an authorization HTTP header to make subsequent service calls via OData or SOAP, for example.</p>
<h1 id="3-odata-client-configuration">3. OData client configuration</h1>
<ul>
<li>Download the project here <a href="https://github.com/microsoft/Dynamics-AX-Integration">https://github.com/microsoft/Dynamics-AX-Integration</a></li>
<li>Open <strong>ServiceSamples</strong> solution.</li>
<li>We cannot use existing proxies and classes, so I need to regenerate them again. Under ODataUtility project, delete <strong>ODataClient.tt</strong> and <strong>ODataClient.ttinclude</strong>.</li>
<li>To regenerate Odata client, right click on <em>ODataUtility project &gt; Add &gt; New item</em>, search for OData in Online and rename it to <strong>ODataClient.tt</strong>.</li>
<li>Open <strong>ODataClient.tt</strong>, in MetadataDocumentUri add <em>&ldquo;https://<yourEnvironment>.cloudax.dynamics.com/data/$metadata&rdquo;</em></li>
</ul>
<p>If you save the ODataClient.tt file, it will generate Odata proxies and classes. From PU12 onward, there are so many entities so you will get an error after compiling</p>
<p>Combined length of user strings used by the program exceeds allowed limit. Try to decrease use of string literals.
{:.error}</p>
<p>There are 2 ways to fix it</p>
<h3 id="a-using-temporary-file">a. Using temporary file</h3>
<p>The simplest way to fix is add TempFilePath, ensure that you have write permission for this path, this is what you got</p>
<p>




<img loading="lazy" decoding="async"
         src="/imagesposts/Consuming-Dynamics-365-Finance-and-Operations-OData-services-from-NET_2.png#center"
         alt="Image"
         title="Consuming-Dynamics-365-Finance-and-Operations-OData-services-from-NET_2.png#center"
    />{:.border}</p>
<p>Save the <strong>ODataClient.tt</strong> and there will be <strong>Test1.xml</strong> file created to store metadata, there should be a bug while generating the xml file, one more step you need to do is replace the double quote to single quote (a global replace of &quot;&quot; with &quot; ), and this is what you have</p>
<p>




<img loading="lazy" decoding="async"
         src="/imagesposts/Consuming-Dynamics-365-Finance-and-Operations-OData-services-from-NET_3.png#center"
         alt="Image"
         title="Consuming-Dynamics-365-Finance-and-Operations-OData-services-from-NET_3.png#center"
    />{:.border}
You can build the project without problem.</p>
<h3 id="b-remove-unused-entities">b. Remove unused entities</h3>
<p>Another work-around that works too, edit the ODataClient.ttinclude so that it parses only some of the entities that you want to use, this reducing the error. For instance, change the following foreach statement</p>
<ul>
<li>Original code:</li>
</ul>
<p>{% highlight csharp %}
foreach (IEdmEntitySet entitySet in container.EntitySets())
{
IEdmEntityType entitySetElementType = entitySet.EntityType();
string entitySetElementTypeName = GetElementTypeName(entitySetElementType, container);</p>
<pre><code>string camelCaseEntitySetName = entitySet.Name;
if (this.context.EnableNamingAlias)
{
    camelCaseEntitySetName = Customization.CustomizeNaming(camelCaseEntitySetName);
}
</code></pre>
<p>}
{% endhighlight %}</p>
<ul>
<li>Modified code:</li>
</ul>
<p>{% highlight csharp %}
foreach (IEdmEntitySet entitySet in container.EntitySets())
{
IEdmEntityType entitySetElementType = entitySet.EntityType();
string entitySetElementTypeName = GetElementTypeName(entitySetElementType, container);</p>
<pre><code>string camelCaseEntitySetName = entitySet.Name;

//start of manual fix 
//only process entity names that containin a specific string, to reduce the string size
if (((camelCaseEntitySetName.Contains(&quot;CUST&quot;)) || (camelCaseEntitySetName.Contains(&quot;VEND&quot;))) || (camelCaseEntitySetName.Contains(&quot;SALES&quot;)))
{
  // emd of manual fix
  if (this.context.EnableNamingAlias)
  {
      camelCaseEntitySetName = Customization.CustomizeNaming(camelCaseEntitySetName);
  }
}
</code></pre>
<p>}
{% endhighlight %}</p>
<h1 id="4-authentication-configuration">4. Authentication configuration</h1>
<p>Under AuthenticationUtility project, you need to modify ClientConfiguration.cs follow, you can get all related information for the first step.</p>
<p>




<img loading="lazy" decoding="async"
         src="/imagesposts/Consuming-Dynamics-365-Finance-and-Operations-OData-services-from-NET_4.png#center"
         alt="Image"
         title="Consuming-Dynamics-365-Finance-and-Operations-OData-services-from-NET_4.png#center"
    />{:.border}</p>
<p>From now, you can freely test the integrations under <strong>ODataConsoleApplication</strong> project.
If you are testing with a custom data entity and you get this error</p>
<p>System.ArgumentOutOfRangeException : Length cannot be less than zero.
{:.error}</p>
<p>Please check this <a href="https://nuxulu.com/2019/12/17/Dynamics-365-finance-and-operations-ODATA-consuming-Length-cannot-be-less-than-zero.html" target="_blank" rel="noopener noreffer">post</a>.</p>
<p>Thank you for reading.</p>
</div>

            <div class="post" style="padding-top: 0">


<div class="post-share"><div class="share-link">
        <a class="share-icon share-twitter" href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://nuxulu.com/2019-12-16-consuming-dynamics-365-finance-and-operations-odata-services-from-net/" data-title="Consuming Dynamics 365 Finance and Operations OData services from .NET" data-hashtags="Postman,OData,BATCH,integration,.NET"><span class="svg-social-icon icon-twitter"></span></a>
    </div><div class="share-link">
        <a class="share-icon share-facebook" href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://nuxulu.com/2019-12-16-consuming-dynamics-365-finance-and-operations-odata-services-from-net/" data-hashtag="Postman"><span class="svg-social-icon icon-facebook"></span></a>
    </div></div>
<div class="post-tags"><a href="/tags/postman/" class="tag">Postman</a><a href="/tags/odata/" class="tag">ODATA</a><a href="/tags/batch/" class="tag">batch</a><a href="/tags/integration/" class="tag">integration</a><a href="/tags/.net/" class="tag">.NET</a></div></div>
        </div>
    <div id="toc-final"></div>
    </article><div class="page single comments content-block-position"></div></div>

</main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Have a nice day!</div><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.83.1">Hugo</a> | Theme - <a href="https://ublogger.netlify.app/?utm_source=https://nuxulu.com&utm_medium=footer&utm_campaign=config&utm_term=2.0.1" target="_blank" title="uBlogger 2.0.1">uBlogger</a>
                </div><div class="footer-line"><i class="svg-icon icon-copyright"></i><span>2013 - 2021</span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="svg-icon icon-arrow-up"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="svg-icon icon-comments-fixed"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script src="/lib/autocomplete/autocomplete.min.js"></script><script src="/lib/lunr/lunr.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script src="/lib/katex/katex.min.js"></script><script src="/lib/katex/auto-render.min.js"></script><script src="/lib/katex/copy-tex.min.js"></script><script src="/lib/katex/mhchem.min.js"></script><script src="/lib/cookieconsent/cookieconsent.min.js"></script><script>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":100},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script src="/js/theme.min.js"></script><script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

	        ga('create', 'UA-57379422-3', 'auto');
	        ga('set', 'anonymizeIp', true);
	        ga('send', 'pageview');
	    </script></body>
</html>
