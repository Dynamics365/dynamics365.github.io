---
layout: post
title: Database logging in Dynamics AX 2012
date: 2015-09-17 11:17:04.000000000 +07:00
type: post
published: true
status: publish
categories:
- SQL Server
tags:
- DatabaseLog
- System Administrator
meta:
  _publicize_pending: '1'
  _edit_last: '60509763'
  original_post_id: '224'
  _wp_old_slug: '224'
author:
  login: luannx
  email: luan52@outlook.com
  display_name: luannx
  first_name: ''
  last_name: ''
---
<p>Dynamics Ax 2012 provide the database level logging. You can track every change not only at table level but also at field of any table.</p>
<p>Dynamics Ax 2012 provide the functionality to log insert update and delete functionality on table as well as selected filed of a table. When tracking on any table in dynamics Ax, a new entry will be created in sysDatabaselog table.</p>
<p>Lets we enable logging on our custom “<em>Student</em>” table.</p>
<p>Go “<em>System Administrator”</em> Module of Dynamics Ax 2012. Under Step tab you will find database node, there you find “<em>Database log”</em> Click on it.</p>
<p>After that Database base logging Wizard will start</p>
<p><img class="alignnone" src="{{ site.baseurl }}/assets/wizard-300x240.png" alt="" width="451" height="361" /></p>
<p><!--more--></p>
<p>Press Next. On next page select “Not Specified” node of tree. All custom table/ user table will be placed under “Not Specified” Node. Dynamics Ax Default tables are placed under their respected module name.</p>
<p><img class="alignnone " src="{{ site.baseurl }}/assets/not-specific-300x238.png" alt="" width="505" height="401" /></p>
<p>Expend the not specified node.  And select the student table there.</p>
<p><img class="alignnone " src="{{ site.baseurl }}/assets/student-300x243.png" alt="" width="493" height="399" /></p>
<p>Here you can track not only table but also possible you can track one or more fields of specific table. In current example we enable tracking or logging on whole student table.</p>
<p><img class="alignnone " src="{{ site.baseurl }}/assets/studentselection-300x242.png" alt="" width="457" height="369" /></p>
<p>Now question is how we can see what will comes in in sysdatabaselog table on insert update or delete on table.  You can view from this link</p>
<p><img class="alignnone size-full" src="{{ site.baseurl }}/assets/log-view-300x233.png" alt="" /></p>
<p>Point to be noted, that all the tables where save per company enables, all log files will be appears in their legal entities. Data is stored in table globally or for all legal entities, you can find their log files under default legal Entity “Dat”.</p>
<p>Now we explore the database structure of SysDatabaselog table. This will help us to get the logged information in X++ code.</p>
<p>Followings are some important fields of SysDatabaseLog table.</p>
<ol>
<li><b>Table:</b>  This filed contains the integer value for each table. A unique integer number attached to each table in dynamics Ax. This fileds tells us on which table operation is performed.</li>
<li style="text-align:justify;"><b> </b><b>Creation Date: </b>This contains the date and time on which entry in <span style="color:#ff6600;">sysDatabaseLog</span> is created.</li>
<li><b>Data: </b> X++ container type this contains the data.</li>
<li><b>LoggType:</b> This described insert, update or delete operation is pefromed at the result current entry is done in sysDatabaselog. It is of enum type. DatabaseLogType::Insert</li>
</ol>
<p>For example, if database logging is enabled on our student table, we can track all insert, update or deleted record form database log table. For example if we have to pull all inserted today records form sysDatabaselog we can do by following way.</p>
<pre class="lang:c# decode:true">static void DatabaseLog(Args _args)
{
    SysDataBaseLog sysDataBaseLog;
    utcDateTime CurrentDate;
    container tableRecord;
    container recordInstance;
    
    str selectedField;
    str fieldName;
    str fieldValue;
    int idx;
    int tableID;
    str  databaseLogSourceCompany;
    
    CurrentDate=DateTimeUtil::newDateTime(today(),str2time(“00:00:00”));
    tableID = tableName2id(‘Student’);
    while SELECT sysDataBaseLog
    WHERE sysDataBaseLog.table == tableID &amp;&amp; sysDataBaseLog.createdDateTime &gt; CurrentDate &amp;&amp; sysDataBaseLog.LogType == DatabaseLogType::Insert
    {
        selectedField = “RollNumber”;
        fieldName=””;
        fieldValue = “”;
        tableRecord = (sysDataBaseLog.Data);
        for( idx = 1; idx &lt;= conLen(tableRecord); idx++)
        {
            recordInstance =  conpeek(tableRecord, idx);
            fieldName = conpeek(recordInstance, 1);
            if(strLwr( fieldName ) == selectedField)
                {
                    fieldValue +=” ” + conpeek(recordInstance, 2) + ” , “;
                    break;
                }
        }

    }
}</pre>
<p>&nbsp;</p>
