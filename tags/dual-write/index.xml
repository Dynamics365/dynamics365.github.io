<rss xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/" version="2.0">
    <channel>
        <title>Dual-write - Tag - Dynamics 365 &amp; Power Platform | nuxulu.com</title>
        <link>https://nuxulu.com/tags/dual-write/</link>
        <description>Dual-write - Tag - Dynamics 365 &amp; Power Platform | nuxulu.com</description>
        <generator>Hugo -- gohugo.io</generator><language>en</language><managingEditor>luan52@outlook.com (Max Nguyen)</managingEditor>
            <webMaster>luan52@outlook.com (Max Nguyen)</webMaster><lastBuildDate>Sun, 02 May 2021 00:00:00 &#43;0000</lastBuildDate><atom:link href="https://nuxulu.com/tags/dual-write/" rel="self" type="application/rss+xml" /><item>
    <title>Develop custom Data Entities for Dual-write</title>
    <link>https://nuxulu.com/2021-05-02-develop-custom-data-entities-for-dual-write/</link>
    <pubDate>Sun, 02 May 2021 00:00:00 &#43;0000</pubDate><author>luan52@outlook.com</author><dc:creator>Max Nguyen</dc:creator><guid>https://nuxulu.com/2021-05-02-develop-custom-data-entities-for-dual-write/</guid>
    <description><![CDATA[<p><a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/dual-write-home-page?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreferrer">Dual-write</a> has been around for almost two years now. It’s one of the ways of <strong>integrating Dynamics 365 Finance and Operations and <a href="https://docs.microsoft.com/en-us/powerapps/maker/data-platform?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreferrer">Dataverse</a></strong> along with <a href="https://ariste.info/en/2020/09/dynamics-365-odata-cds-virtual-entities/" target="_blank" rel="noopener noreferrer">Virtual Entities</a>.</p>
<p>The standard solution comes with many <strong>out-of-the-box entities</strong> available to synchronize. This has been one of the great improvements since Dual-write was made available in preview, when <a href="https://jatomas.com/" target="_blank" rel="noopener noreferrer">Juanan</a> and I <a href="https://www.youtube.com/watch?v=z_dLGDF7Ci0" target="_blank" rel="noopener noreferrer">demoed it in the 2019 Dynamics Saturday in Madrid</a>.</p>
<p><figure><a class="lightgallery" href="https://static.ariste.info/wp-content/uploads/2021/03/DW-1024x1024.png" title="Dual write" data-thumbnail="https://static.ariste.info/wp-content/uploads/2021/03/DW-1024x1024.png" data-sub-html="<h2>Develop custom Data Entities for Dual-write 1</h2><p>Dual write</p>">
        
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 1</figcaption>
    </figure></p>
<p>This is how Dual write really works</p>
<p>But what if we need to develop a <strong>new custom Data Entity in MSDyn365FO</strong> and use it in Dual-write? It’s easy but there’s some things we need to remember when doing it.</p>
<h2 id="httpsaristeinfoen202103develop-custom-data-entities-dual-writedual-writedual-write"><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#dual-write" target="_blank" rel="noopener noreferrer"></a>Dual-write</h2>
<p><a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/dual-write-home-page?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreferrer">Dual-write</a> is a bidirectional integration that will synchronously write in Dataverse when data is created, updated or deleted in MSDyn365FO in near-real-time. On the Finance and Operations side it uses data entities to export data to Dataverse.</p>
<p>Right now there’s a set of several OOB entities that come ready to be synchronized, and thanks to <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/initial-sync-guidance?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreferrer">Initial Sync</a> we can populate data in Dataverse choosing FnO as the source when starting the sync, or also choose Dataverse as the source.</p>
<p>If you want to learn more about Dual-write you can:</p>
<ul>
<li>Read <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/dual-write-home-page?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreferrer">the docs</a> which have plenty of information. <strong>Read the docs</strong>. Always.</li>
<li><a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/connection-setup?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreferrer">Guidance for Dual-Write setup</a></li>
<li><a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/requirements-and-prerequisites?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreferrer">System requirements and prerequisites</a></li>
<li>Watch some of <a href="https://daxture.blogspot.com/" target="_blank" rel="noopener noreferrer">Faisal Fareed</a>‘s sessions about Dual-write: <a href="https://dynamicscon.com/" target="_blank" rel="noopener noreferrer">DynamicsCon</a> 2020: <a href="https://www.youtube.com/watch?v=DbyLLQswM5o" target="_blank" rel="noopener noreferrer">The Power of Dual-write</a> or Scottish Summit 2021: <a href="https://www.youtube.com/watch?v=O2iuM6dWklI" target="_blank" rel="noopener noreferrer">D365 FO integration with Dataverse – Dual write, Virtual Entities, OR Data Integrator</a>. He’s got some more which you can find on Youtube.</li>
</ul>
<h2 id="httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-the-data-entitycreate-the-data-entity"><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-the-data-entity" target="_blank" rel="noopener noreferrer"></a>Create the Data-entity</h2>
<p>In Visual Studio we need to create the entity from our table. I’ve created a new table called AASBookTable with just four fields: BookId, Author, Name and ISBN. Its primary key is the BookId field which is also its <strong>alternate key</strong> and will be used as natural key in the entity.</p>
<p>Next, we create the data entity and make sure we’re marking the “<strong>Enable data management capabilities</strong>” checkbox:</p>
<p><figure><a class="lightgallery" href="https://static.ariste.info/wp-content/uploads/2021/03/DW1.png" title="Dynamics 365 Finance and Operations Data entity wizard" data-thumbnail="https://static.ariste.info/wp-content/uploads/2021/03/DW1.png" data-sub-html="<h2>Develop custom Data Entities for Dual-write 2</h2><p>Dynamics 365 Finance and Operations Data entity wizard</p>">
        
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 2</figcaption>
    </figure></p>
<p>Enable data management capabilities must be checked</p>
<p>If the entity doesn’t have data management enabled it won’t be displayed in the list in the Dual-write tables setup.</p>
<h2 id="httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-a-table-in-dataversecreate-a-table-in-dataverse"><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-a-table-in-dataverse" target="_blank" rel="noopener noreferrer"></a>Create a table in Dataverse</h2>
<p>Now we need to create a table in our Dataverse environment. This table must have at least some of the fields we want to synchronize to Dataverse <strong>AND</strong> a company field. <strong>The <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/company-data?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreferrer">company</a> concept doesn’t exist in Dataverse/CRM</strong> but thanks to the OOB mappings and <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/initial-sync-guidance?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreferrer">Initial Sync</a> we can solve this with just a few clicks and will have a company table in Dataverse with all our FnO legal entities.</p>
<p><figure><a class="lightgallery" href="https://static.ariste.info/wp-content/uploads/2021/03/DW2.png" title="Company field related to table company" data-thumbnail="https://static.ariste.info/wp-content/uploads/2021/03/DW2.png" data-sub-html="<h2>Develop custom Data Entities for Dual-write 3</h2><p>Company field related to table company</p>">
        
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 3</figcaption>
    </figure></p>
<p>Company field related to table company</p>
<p>Following my example I’ve created a table with the same four fields and a company field with the <strong>data type Lookup</strong> and its related table Company, where the FnO legal entities are synchronized.</p>
<p>As I said, if we don’t create this field we won-t be able to setup Dual-write for this table.</p>
<h2 id="httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-table-mapcreate-table-map"><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-table-map" target="_blank" rel="noopener noreferrer"></a>Create table map</h2>
<p>Our table and data entity are ready, and now <strong>we need to <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/enable-entity-map?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreferrer">create a mapping</a> between them</strong> in the Dual-write workspace in FnO. Click the “Add table map” button:</p>
<p><figure><a class="lightgallery" href="https://static.ariste.info/wp-content/uploads/2021/03/DW3.png" title="Dynamics 365 Dual-write add table map" data-thumbnail="https://static.ariste.info/wp-content/uploads/2021/03/DW3.png" data-sub-html="<h2>Develop custom Data Entities for Dual-write 4</h2><p>Dynamics 365 Dual-write add table map</p>">
        
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 4</figcaption>
    </figure></p>
<p>Dynamics 365 Dual-write add table map</p>
<p>A new dialog will open and we need to select the FnO entity and the Dataverse table:</p>
<p><figure><a class="lightgallery" href="https://static.ariste.info/wp-content/uploads/2021/03/DW4-edited.png" title="Entity map" data-thumbnail="https://static.ariste.info/wp-content/uploads/2021/03/DW4-edited.png" data-sub-html="<h2>Develop custom Data Entities for Dual-write 5</h2><p>Entity map</p>">
        
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 5</figcaption>
    </figure></p>
<p>Entity map</p>
<p>Select the entity and table we’ve created and click save. Then we can define the field mapping:</p>
<p><figure><a class="lightgallery" href="https://static.ariste.info/wp-content/uploads/2021/03/DW13-1024x629.png" title="Dynamics 365 Dual-write field maps" data-thumbnail="https://static.ariste.info/wp-content/uploads/2021/03/DW13-1024x629.png" data-sub-html="<h2>Develop custom Data Entities for Dual-write 6</h2><p>Dynamics 365 Dual-write field maps</p>">
        
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 6</figcaption>
    </figure></p>
<p>Dynamics 365 Dual-write field maps</p>
<p>Because I’ve created both it’s clear what to map. And after doing this we can click save and it’s done, right? No! <strong>WRONG</strong>! If we do just this we’ll get an error, this error:</p>
<blockquote>
<p>Project validation failed. SourceEntitySchema: Books has a primaryCompanyField set to DataAreaId and DestinationEntitySchema: cr008_bookses doesn’t have primary company field set. Dual-write only supports mapping between cross-company entities or company-specific entities from both sides..keys are missing for either AX or CRM.keys are missing for either CRM or AX</p>
</blockquote>
<p>Or we can also get an error regarding a missing integration key for the company field. In the end both are caused because <strong>we’ve missed defining the integration key</strong> for this new Dataverse table:</p>
<h2 id="httpsaristeinfoen202103develop-custom-data-entities-dual-writeintegration-keyintegration-key"><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#integration-key" target="_blank" rel="noopener noreferrer"></a>Integration key</h2>
<p>Go back to the main Dual-write form and click on the “Integration key” button:</p>
<p><figure><a class="lightgallery" href="https://static.ariste.info/wp-content/uploads/2021/03/DW7.png" title="Dual/write integration key" data-thumbnail="https://static.ariste.info/wp-content/uploads/2021/03/DW7.png" data-sub-html="<h2>Develop custom Data Entities for Dual-write 7</h2><p>Dual/write integration key</p>">
        
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 7</figcaption>
    </figure></p>
<p>Dual-write integration key</p>
<p>The integration key will be <strong>the same as the FnO data entity key, plus the company</strong> if your data entity has a company context. Remember that when we create indexes in FnO the DataAreaId field isn’t included in the field, but it is in the SQL Server index along the partition field.</p>
<p>The integration key for our custom Dual-write mapping will look like this:</p>
<p><figure><a class="lightgallery" href="https://static.ariste.info/wp-content/uploads/2021/03/DW11.png" title="Dual/write integration key" data-thumbnail="https://static.ariste.info/wp-content/uploads/2021/03/DW11.png" data-sub-html="<h2>Develop custom Data Entities for Dual-write 8</h2><p>Dual/write integration key</p>">
        
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 8</figcaption>
    </figure></p>
<p>Dual/write integration key</p>
<p>Remember we’ve added the company field to our Dataverse table? You can see in the image above that the field includes the relation to the Company table in Dataverse. We won’t be able to save the field mapping if we create the key using our Dataverse table’s company field instead of its Company table relation, like this:</p>
<p><figure><a class="lightgallery" href="https://static.ariste.info/wp-content/uploads/2021/03/DW9.png" title="Dual/write integration key" data-thumbnail="https://static.ariste.info/wp-content/uploads/2021/03/DW9.png" data-sub-html="<h2>Develop custom Data Entities for Dual-write 9</h2><p>Dual/write integration key</p>">
        
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 9</figcaption>
    </figure></p>
<p>Dual/write integration key</p>
<p>See the difference? In the first image the field reads <em>c008_company.cdm_companycode</em> while in the second one it’s <em>c008_company</em>. If we set the integration key using the field in our table instead of the related table and save the fields’ mapping we’ll get an error saying the company is missing in the key because it’s expecting the relation!</p>
<h2 id="httpsaristeinfoen202103develop-custom-data-entities-dual-writeactionaction"><a href="https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#action" target="_blank" rel="noopener noreferrer"></a>Action!</h2>
<p>The table and field mappings are ready, just click run and go create a new book in the FnO form:</p>
<p><figure><a class="lightgallery" href="https://static.ariste.info/wp-content/uploads/2021/03/DW14.png" title="Finance and Operations form" data-thumbnail="https://static.ariste.info/wp-content/uploads/2021/03/DW14.png" data-sub-html="<h2>Develop custom Data Entities for Dual-write 10</h2><p>Finance and Operations form</p>">
        
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 10</figcaption>
    </figure></p>
<p>Finance and Operations form</p>
<p>Then we go to our Dataverse table and check its data…</p>
<p><figure><a class="lightgallery" href="https://static.ariste.info/wp-content/uploads/2021/03/DW15.png" title="Dataverse table data" data-thumbnail="https://static.ariste.info/wp-content/uploads/2021/03/DW15.png" data-sub-html="<h2>Develop custom Data Entities for Dual-write 11</h2><p>Dataverse table data</p>">
        
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 11</figcaption>
    </figure></p>
<p>Dataverse table data</p>
<p>It’s there! And of course it’s working in both directions. If I create a record in Dataverse it’ll be created in FnO too. I’ll use the Excel add-in to add a new book:</p>
<p><figure><a class="lightgallery" href="https://static.ariste.info/wp-content/uploads/2021/03/DW16.png" title="Dataverse Excel add-in" data-thumbnail="https://static.ariste.info/wp-content/uploads/2021/03/DW16.png" data-sub-html="<h2>Develop custom Data Entities for Dual-write 12</h2><p>Dataverse Excel add-in</p>">
        
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 12</figcaption>
    </figure></p>
<p>Dataverse Excel add-in</p>
<p>And after refreshing the form in FnO we can see it there too:</p>
<p><figure><a class="lightgallery" href="https://static.ariste.info/wp-content/uploads/2021/03/DW17.png" title="Develop custom Data Entities for Dual-write 1" data-thumbnail="https://static.ariste.info/wp-content/uploads/2021/03/DW17.png" data-sub-html="<h2>Develop custom Data Entities for Dual-write 13</h2><p>Develop custom Data Entities for Dual-write 1</p>">
        
    </a><figcaption class="image-caption">Develop custom Data Entities for Dual-write 13</figcaption>
    </figure></p>
<p>This is a really simple example of how we can create a custom table, use it in a data entity and then use this entity in our dual-write setup. It’s something that can be easily done but we need to <strong>remember the “company thing”</strong>, otherwise this will never work!</p>
<p>Dual-write is even easier to configure nowadays thanks to <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/lcs-setup?WT.mc_id=BA-MVP-5003976" target="_blank" rel="noopener noreferrer">LCS allowing us to create and link a new Dataverse environment when we deploy a new Finance and Operations environment</a>.</p>
]]></description>
</item></channel>
</rss>
