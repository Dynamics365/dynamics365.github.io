<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Develop custom Data Entities for Dual-write | Dynamics 365 Finance Operations & Power Platform</title><meta name=keywords content="Dynamics 365 Finance,Dynamics 365 Supply Chain Management,Dynamics 365 Commerce,Dual-write,ALM,Data Entities"><meta name=description content="Dual-write has been around for almost two years now. It’s one of the ways of integrating Dynamics 365 Finance and Operations and Dataverse along with Virtual Entities.
The standard solution comes with many out-of-the-box entities available to synchronize. This has been one of the great improvements since Dual-write was made available in preview, when Juanan and I demoed it in the 2019 Dynamics Saturday in Madrid.
This is how Dual write really works"><meta name=author content="Max Nguyen"><link rel=canonical href=https://nuxulu.com/posts/2021-05-02-develop-custom-data-entities-for-dual-write/><link href=/assets/css/stylesheet.min.css rel="preload stylesheet" as=style><link rel=icon href=https://nuxulu.com/Icon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://nuxulu.com/Icon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://nuxulu.com/Icon/favicon-32x32.png><link rel=apple-touch-icon href=https://nuxulu.com/Icon/favicon-32x32.png><link rel=mask-icon href=https://nuxulu.com/Icon/favicon-16x16.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-57379422-3','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Develop custom Data Entities for Dual-write"><meta property="og:description" content="Dual-write has been around for almost two years now. It’s one of the ways of integrating Dynamics 365 Finance and Operations and Dataverse along with Virtual Entities.
The standard solution comes with many out-of-the-box entities available to synchronize. This has been one of the great improvements since Dual-write was made available in preview, when Juanan and I demoed it in the 2019 Dynamics Saturday in Madrid.
This is how Dual write really works"><meta property="og:type" content="article"><meta property="og:url" content="https://nuxulu.com/posts/2021-05-02-develop-custom-data-entities-for-dual-write/"><meta property="og:image" content="https://nuxulu.com/47"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-02T00:00:00+00:00"><meta property="article:modified_time" content="2021-05-02T00:00:00+00:00"><meta property="og:site_name" content="Dynamics 365 Finance Operations & Power Platform"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nuxulu.com/47"><meta name=twitter:title content="Develop custom Data Entities for Dual-write"><meta name=twitter:description content="Dual-write has been around for almost two years now. It’s one of the ways of integrating Dynamics 365 Finance and Operations and Dataverse along with Virtual Entities.
The standard solution comes with many out-of-the-box entities available to synchronize. This has been one of the great improvements since Dual-write was made available in preview, when Juanan and I demoed it in the 2019 Dynamics Saturday in Madrid.
This is how Dual write really works"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://nuxulu.com/posts/"},{"@type":"ListItem","position":3,"name":"Develop custom Data Entities for Dual-write","item":"https://nuxulu.com/posts/2021-05-02-develop-custom-data-entities-for-dual-write/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Develop custom Data Entities for Dual-write","name":"Develop custom Data Entities for Dual-write","description":"Dual-write has been around for almost two years now. It’s one of the ways of integrating Dynamics 365 Finance and Operations and Dataverse along with Virtual Entities.\nThe standard solution comes with many out-of-the-box entities available to synchronize. This has been one of the great improvements since Dual-write was made available in preview, when Juanan and I demoed it in the 2019 Dynamics Saturday in Madrid.\nThis is how Dual write really works","keywords":["Dynamics 365 Finance","Dynamics 365 Supply Chain Management","Dynamics 365 Commerce","Dual-write","ALM","Data Entities"],"articleBody":"Dual-write has been around for almost two years now. It’s one of the ways of integrating Dynamics 365 Finance and Operations and Dataverse along with Virtual Entities.\nThe standard solution comes with many out-of-the-box entities available to synchronize. This has been one of the great improvements since Dual-write was made available in preview, when Juanan and I demoed it in the 2019 Dynamics Saturday in Madrid.\nThis is how Dual write really works\nBut what if we need to develop a new custom Data Entity in MSDyn365FO and use it in Dual-write? It’s easy but there’s some things we need to remember when doing it.\nDual-write Dual-write is a bidirectional integration that will synchronously write in Dataverse when data is created, updated or deleted in MSDyn365FO in near-real-time. On the Finance and Operations side it uses data entities to export data to Dataverse.\nRight now there’s a set of several OOB entities that come ready to be synchronized, and thanks to Initial Sync we can populate data in Dataverse choosing FnO as the source when starting the sync, or also choose Dataverse as the source.\nIf you want to learn more about Dual-write you can:\n Read the docs which have plenty of information. Read the docs. Always. Guidance for Dual-Write setup System requirements and prerequisites Watch some of Faisal Fareed‘s sessions about Dual-write: DynamicsCon 2020: The Power of Dual-write or Scottish Summit 2021: D365 FO integration with Dataverse – Dual write, Virtual Entities, OR Data Integrator. He’s got some more which you can find on Youtube.  Create the Data-entity In Visual Studio we need to create the entity from our table. I’ve created a new table called AASBookTable with just four fields: BookId, Author, Name and ISBN. Its primary key is the BookId field which is also its alternate key and will be used as natural key in the entity.\nNext, we create the data entity and make sure we’re marking the “Enable data management capabilities” checkbox:\nEnable data management capabilities must be checked\nIf the entity doesn’t have data management enabled it won’t be displayed in the list in the Dual-write tables setup.\nCreate a table in Dataverse Now we need to create a table in our Dataverse environment. This table must have at least some of the fields we want to synchronize to Dataverse AND a company field. The company concept doesn’t exist in Dataverse/CRM but thanks to the OOB mappings and Initial Sync we can solve this with just a few clicks and will have a company table in Dataverse with all our FnO legal entities.\nCompany field related to table company\nFollowing my example I’ve created a table with the same four fields and a company field with the data type Lookup and its related table Company, where the FnO legal entities are synchronized.\nAs I said, if we don’t create this field we won-t be able to setup Dual-write for this table.\nCreate table map Our table and data entity are ready, and now we need to create a mapping between them in the Dual-write workspace in FnO. Click the “Add table map” button:\nDynamics 365 Dual-write add table map\nA new dialog will open and we need to select the FnO entity and the Dataverse table:\nEntity map\nSelect the entity and table we’ve created and click save. Then we can define the field mapping:\nDynamics 365 Dual-write field maps\nBecause I’ve created both it’s clear what to map. And after doing this we can click save and it’s done, right? No! WRONG! If we do just this we’ll get an error, this error:\n Project validation failed. SourceEntitySchema: Books has a primaryCompanyField set to DataAreaId and DestinationEntitySchema: cr008_bookses doesn’t have primary company field set. Dual-write only supports mapping between cross-company entities or company-specific entities from both sides..keys are missing for either AX or CRM.keys are missing for either CRM or AX\n Or we can also get an error regarding a missing integration key for the company field. In the end both are caused because we’ve missed defining the integration key for this new Dataverse table:\nIntegration key Go back to the main Dual-write form and click on the “Integration key” button:\nDual-write integration key\nThe integration key will be the same as the FnO data entity key, plus the company if your data entity has a company context. Remember that when we create indexes in FnO the DataAreaId field isn’t included in the field, but it is in the SQL Server index along the partition field.\nThe integration key for our custom Dual-write mapping will look like this:\nDual/write integration key\nRemember we’ve added the company field to our Dataverse table? You can see in the image above that the field includes the relation to the Company table in Dataverse. We won’t be able to save the field mapping if we create the key using our Dataverse table’s company field instead of its Company table relation, like this:\nDual/write integration key\nSee the difference? In the first image the field reads c008_company.cdm_companycode while in the second one it’s c008_company. If we set the integration key using the field in our table instead of the related table and save the fields’ mapping we’ll get an error saying the company is missing in the key because it’s expecting the relation!\nAction! The table and field mappings are ready, just click run and go create a new book in the FnO form:\nFinance and Operations form\nThen we go to our Dataverse table and check its data…\nDataverse table data\nIt’s there! And of course it’s working in both directions. If I create a record in Dataverse it’ll be created in FnO too. I’ll use the Excel add-in to add a new book:\nDataverse Excel add-in\nAnd after refreshing the form in FnO we can see it there too:\nThis is a really simple example of how we can create a custom table, use it in a data entity and then use this entity in our dual-write setup. It’s something that can be easily done but we need to remember the “company thing”, otherwise this will never work!\nDual-write is even easier to configure nowadays thanks to LCS allowing us to create and link a new Dataverse environment when we deploy a new Finance and Operations environment.\n","wordCount":"1050","inLanguage":"en","datePublished":"2021-05-02T00:00:00Z","dateModified":"2021-05-02T00:00:00Z","author":{"@type":"Person","name":"Max Nguyen"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://nuxulu.com/posts/2021-05-02-develop-custom-data-entities-for-dual-write/"},"publisher":{"@type":"Organization","name":"Dynamics 365 Finance Operations \u0026 Power Platform","logo":{"@type":"ImageObject","url":"https://nuxulu.com/Icon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://nuxulu.com accesskey=h title="Dynamics 365 & Power Platform (Alt + H)"><img src=/Icon//favicon-32x32.png alt=logo aria-label=logo height=35>Dynamics 365 & Power Platform</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://nuxulu.com/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://nuxulu.com/categories/ title=categories><span>categories</span></a></li><li><a href=https://nuxulu.com/tags/ title=tags><span>tags</span></a></li><li><a href=https://nuxulu.com/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://nuxulu.com>Home</a>&nbsp;»&nbsp;<a href=https://nuxulu.com/posts/>Posts</a></div><h1 class=post-title>Develop custom Data Entities for Dual-write</h1><div class=post-meta>May 2, 2021&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Max Nguyen
|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts%5c2021-05-02-Develop-custom-Data-Entities-for-Dual-write.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#httpsaristeinfoen202103develop-custom-data-entities-dual-writedual-writedual-write aria-label=Dual-write><a href=https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#dual-write></a>Dual-write</a></li><li><a href=#httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-the-data-entitycreate-the-data-entity aria-label="Create the Data-entity"><a href=https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-the-data-entity></a>Create the Data-entity</a></li><li><a href=#httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-a-table-in-dataversecreate-a-table-in-dataverse aria-label="Create a table in Dataverse"><a href=https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-a-table-in-dataverse></a>Create a table in Dataverse</a></li><li><a href=#httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-table-mapcreate-table-map aria-label="Create table map"><a href=https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-table-map></a>Create table map</a></li><li><a href=#httpsaristeinfoen202103develop-custom-data-entities-dual-writeintegration-keyintegration-key aria-label="Integration key"><a href=https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#integration-key></a>Integration key</a></li><li><a href=#httpsaristeinfoen202103develop-custom-data-entities-dual-writeactionaction aria-label=Action!><a href=https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#action></a>Action!</a></li></ul></div></details></div><div class=post-content><p><a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/dual-write-home-page?WT.mc_id=BA-MVP-5003976">Dual-write</a> has been around for almost two years now. It’s one of the ways of <strong>integrating Dynamics 365 Finance and Operations and <a href="https://docs.microsoft.com/en-us/powerapps/maker/data-platform?WT.mc_id=BA-MVP-5003976">Dataverse</a></strong> along with <a href=https://ariste.info/en/2020/09/dynamics-365-odata-cds-virtual-entities/>Virtual Entities</a>.</p><p>The standard solution comes with many <strong>out-of-the-box entities</strong> available to synchronize. This has been one of the great improvements since Dual-write was made available in preview, when <a href=https://jatomas.com/>Juanan</a> and I <a href="https://www.youtube.com/watch?v=z_dLGDF7Ci0">demoed it in the 2019 Dynamics Saturday in Madrid</a>.</p><p><img loading=lazy src=https://static.ariste.info/wp-content/uploads/2021/03/DW-1024x1024.png#center alt="Dual write" title="Develop custom Data Entities for Dual-write 1"></p><p>This is how Dual write really works</p><p>But what if we need to develop a <strong>new custom Data Entity in MSDyn365FO</strong> and use it in Dual-write? It’s easy but there’s some things we need to remember when doing it.</p><h2 id=httpsaristeinfoen202103develop-custom-data-entities-dual-writedual-writedual-write><a href=https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#dual-write></a>Dual-write<a hidden class=anchor aria-hidden=true href=#httpsaristeinfoen202103develop-custom-data-entities-dual-writedual-writedual-write>#</a></h2><p><a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/dual-write-home-page?WT.mc_id=BA-MVP-5003976">Dual-write</a> is a bidirectional integration that will synchronously write in Dataverse when data is created, updated or deleted in MSDyn365FO in near-real-time. On the Finance and Operations side it uses data entities to export data to Dataverse.</p><p>Right now there’s a set of several OOB entities that come ready to be synchronized, and thanks to <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/initial-sync-guidance?WT.mc_id=BA-MVP-5003976">Initial Sync</a> we can populate data in Dataverse choosing FnO as the source when starting the sync, or also choose Dataverse as the source.</p><p>If you want to learn more about Dual-write you can:</p><ul><li>Read <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/dual-write-home-page?WT.mc_id=BA-MVP-5003976">the docs</a> which have plenty of information. <strong>Read the docs</strong>. Always.</li><li><a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/connection-setup?WT.mc_id=BA-MVP-5003976">Guidance for Dual-Write setup</a></li><li><a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/requirements-and-prerequisites?WT.mc_id=BA-MVP-5003976">System requirements and prerequisites</a></li><li>Watch some of <a href=https://daxture.blogspot.com/>Faisal Fareed</a>‘s sessions about Dual-write: <a href=https://dynamicscon.com/>DynamicsCon</a> 2020: <a href="https://www.youtube.com/watch?v=DbyLLQswM5o">The Power of Dual-write</a> or Scottish Summit 2021: <a href="https://www.youtube.com/watch?v=O2iuM6dWklI">D365 FO integration with Dataverse – Dual write, Virtual Entities, OR Data Integrator</a>. He’s got some more which you can find on Youtube.</li></ul><h2 id=httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-the-data-entitycreate-the-data-entity><a href=https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-the-data-entity></a>Create the Data-entity<a hidden class=anchor aria-hidden=true href=#httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-the-data-entitycreate-the-data-entity>#</a></h2><p>In Visual Studio we need to create the entity from our table. I’ve created a new table called AASBookTable with just four fields: BookId, Author, Name and ISBN. Its primary key is the BookId field which is also its <strong>alternate key</strong> and will be used as natural key in the entity.</p><p>Next, we create the data entity and make sure we’re marking the “<strong>Enable data management capabilities</strong>” checkbox:</p><p><img loading=lazy src=https://static.ariste.info/wp-content/uploads/2021/03/DW1.png#center alt="Dynamics 365 Finance and Operations Data entity wizard" title="Develop custom Data Entities for Dual-write 2"></p><p>Enable data management capabilities must be checked</p><p>If the entity doesn’t have data management enabled it won’t be displayed in the list in the Dual-write tables setup.</p><h2 id=httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-a-table-in-dataversecreate-a-table-in-dataverse><a href=https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-a-table-in-dataverse></a>Create a table in Dataverse<a hidden class=anchor aria-hidden=true href=#httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-a-table-in-dataversecreate-a-table-in-dataverse>#</a></h2><p>Now we need to create a table in our Dataverse environment. This table must have at least some of the fields we want to synchronize to Dataverse <strong>AND</strong> a company field. <strong>The <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/company-data?WT.mc_id=BA-MVP-5003976">company</a> concept doesn’t exist in Dataverse/CRM</strong> but thanks to the OOB mappings and <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/initial-sync-guidance?WT.mc_id=BA-MVP-5003976">Initial Sync</a> we can solve this with just a few clicks and will have a company table in Dataverse with all our FnO legal entities.</p><p><img loading=lazy src=https://static.ariste.info/wp-content/uploads/2021/03/DW2.png#center alt="Company field related to table company" title="Develop custom Data Entities for Dual-write 3"></p><p>Company field related to table company</p><p>Following my example I’ve created a table with the same four fields and a company field with the <strong>data type Lookup</strong> and its related table Company, where the FnO legal entities are synchronized.</p><p>As I said, if we don’t create this field we won-t be able to setup Dual-write for this table.</p><h2 id=httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-table-mapcreate-table-map><a href=https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#create-table-map></a>Create table map<a hidden class=anchor aria-hidden=true href=#httpsaristeinfoen202103develop-custom-data-entities-dual-writecreate-table-mapcreate-table-map>#</a></h2><p>Our table and data entity are ready, and now <strong>we need to <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/enable-entity-map?WT.mc_id=BA-MVP-5003976">create a mapping</a> between them</strong> in the Dual-write workspace in FnO. Click the “Add table map” button:</p><p><img loading=lazy src=https://static.ariste.info/wp-content/uploads/2021/03/DW3.png#center alt="Dynamics 365 Dual-write add table map" title="Develop custom Data Entities for Dual-write 4"></p><p>Dynamics 365 Dual-write add table map</p><p>A new dialog will open and we need to select the FnO entity and the Dataverse table:</p><p><img loading=lazy src=https://static.ariste.info/wp-content/uploads/2021/03/DW4-edited.png#center alt="Entity map" title="Develop custom Data Entities for Dual-write 5"></p><p>Entity map</p><p>Select the entity and table we’ve created and click save. Then we can define the field mapping:</p><p><img loading=lazy src=https://static.ariste.info/wp-content/uploads/2021/03/DW13-1024x629.png#center alt="Dynamics 365 Dual-write field maps" title="Develop custom Data Entities for Dual-write 6"></p><p>Dynamics 365 Dual-write field maps</p><p>Because I’ve created both it’s clear what to map. And after doing this we can click save and it’s done, right? No! <strong>WRONG</strong>! If we do just this we’ll get an error, this error:</p><blockquote><p>Project validation failed. SourceEntitySchema: Books has a primaryCompanyField set to DataAreaId and DestinationEntitySchema: cr008_bookses doesn’t have primary company field set. Dual-write only supports mapping between cross-company entities or company-specific entities from both sides..keys are missing for either AX or CRM.keys are missing for either CRM or AX</p></blockquote><p>Or we can also get an error regarding a missing integration key for the company field. In the end both are caused because <strong>we’ve missed defining the integration key</strong> for this new Dataverse table:</p><h2 id=httpsaristeinfoen202103develop-custom-data-entities-dual-writeintegration-keyintegration-key><a href=https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#integration-key></a>Integration key<a hidden class=anchor aria-hidden=true href=#httpsaristeinfoen202103develop-custom-data-entities-dual-writeintegration-keyintegration-key>#</a></h2><p>Go back to the main Dual-write form and click on the “Integration key” button:</p><p><img loading=lazy src=https://static.ariste.info/wp-content/uploads/2021/03/DW7.png#center alt="Dual/write integration key" title="Develop custom Data Entities for Dual-write 7"></p><p>Dual-write integration key</p><p>The integration key will be <strong>the same as the FnO data entity key, plus the company</strong> if your data entity has a company context. Remember that when we create indexes in FnO the DataAreaId field isn’t included in the field, but it is in the SQL Server index along the partition field.</p><p>The integration key for our custom Dual-write mapping will look like this:</p><p><img loading=lazy src=https://static.ariste.info/wp-content/uploads/2021/03/DW11.png#center alt="Dual/write integration key" title="Develop custom Data Entities for Dual-write 8"></p><p>Dual/write integration key</p><p>Remember we’ve added the company field to our Dataverse table? You can see in the image above that the field includes the relation to the Company table in Dataverse. We won’t be able to save the field mapping if we create the key using our Dataverse table’s company field instead of its Company table relation, like this:</p><p><img loading=lazy src=https://static.ariste.info/wp-content/uploads/2021/03/DW9.png#center alt="Dual/write integration key" title="Develop custom Data Entities for Dual-write 9"></p><p>Dual/write integration key</p><p>See the difference? In the first image the field reads <em>c008_company.cdm_companycode</em> while in the second one it’s <em>c008_company</em>. If we set the integration key using the field in our table instead of the related table and save the fields’ mapping we’ll get an error saying the company is missing in the key because it’s expecting the relation!</p><h2 id=httpsaristeinfoen202103develop-custom-data-entities-dual-writeactionaction><a href=https://ariste.info/en/2021/03/develop-custom-data-entities-dual-write/#action></a>Action!<a hidden class=anchor aria-hidden=true href=#httpsaristeinfoen202103develop-custom-data-entities-dual-writeactionaction>#</a></h2><p>The table and field mappings are ready, just click run and go create a new book in the FnO form:</p><p><img loading=lazy src=https://static.ariste.info/wp-content/uploads/2021/03/DW14.png#center alt="Finance and Operations form" title="Develop custom Data Entities for Dual-write 10"></p><p>Finance and Operations form</p><p>Then we go to our Dataverse table and check its data…</p><p><img loading=lazy src=https://static.ariste.info/wp-content/uploads/2021/03/DW15.png#center alt="Dataverse table data" title="Develop custom Data Entities for Dual-write 11"></p><p>Dataverse table data</p><p>It’s there! And of course it’s working in both directions. If I create a record in Dataverse it’ll be created in FnO too. I’ll use the Excel add-in to add a new book:</p><p><img loading=lazy src=https://static.ariste.info/wp-content/uploads/2021/03/DW16.png#center alt="Dataverse Excel add-in" title="Develop custom Data Entities for Dual-write 12"></p><p>Dataverse Excel add-in</p><p>And after refreshing the form in FnO we can see it there too:</p><p><img loading=lazy src=https://static.ariste.info/wp-content/uploads/2021/03/DW17.png#center alt="Develop custom Data Entities for Dual-write 1" title="Develop custom Data Entities for Dual-write 13"></p><p>This is a really simple example of how we can create a custom table, use it in a data entity and then use this entity in our dual-write setup. It’s something that can be easily done but we need to <strong>remember the “company thing”</strong>, otherwise this will never work!</p><p>Dual-write is even easier to configure nowadays thanks to <a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/lcs-setup?WT.mc_id=BA-MVP-5003976">LCS allowing us to create and link a new Dataverse environment when we deploy a new Finance and Operations environment</a>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://nuxulu.com/tags/dynamics-365-finance/>Dynamics 365 Finance</a></li><li><a href=https://nuxulu.com/tags/dynamics-365-supply-chain-management/>Dynamics 365 Supply Chain Management</a></li><li><a href=https://nuxulu.com/tags/dynamics-365-commerce/>Dynamics 365 Commerce</a></li><li><a href=https://nuxulu.com/tags/dual-write/>Dual-write</a></li><li><a href=https://nuxulu.com/tags/alm/>ALM</a></li><li><a href=https://nuxulu.com/tags/data-entities/>Data Entities</a></li></ul><nav class=paginav><a class=prev href=https://nuxulu.com/posts/2021-05-03-azure-devtest-labs-powered-builds-for-dynamics-365-finops/><span class=title>« Prev Page</span><br><span>Azure DevTest Labs powered builds for Dynamics 365 FinOps</span></a>
<a class=next href=https://nuxulu.com/posts/2021-05-01-dynamics-365-for-finance-operations-and-azure-devops/><span class=title>Next Page »</span><br><span>Dynamics 365 for Finance & Operations and Azure DevOps</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Develop custom Data Entities for Dual-write on twitter" href="https://twitter.com/intent/tweet/?text=Develop%20custom%20Data%20Entities%20for%20Dual-write&url=https%3a%2f%2fnuxulu.com%2fposts%2f2021-05-02-develop-custom-data-entities-for-dual-write%2f&hashtags=Dynamics365Finance%2cDynamics365SupplyChainManagement%2cDynamics365Commerce%2cDual-write%2cALM%2cDataEntities"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Develop custom Data Entities for Dual-write on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fnuxulu.com%2fposts%2f2021-05-02-develop-custom-data-entities-for-dual-write%2f&title=Develop%20custom%20Data%20Entities%20for%20Dual-write&summary=Develop%20custom%20Data%20Entities%20for%20Dual-write&source=https%3a%2f%2fnuxulu.com%2fposts%2f2021-05-02-develop-custom-data-entities-for-dual-write%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Develop custom Data Entities for Dual-write on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fnuxulu.com%2fposts%2f2021-05-02-develop-custom-data-entities-for-dual-write%2f&title=Develop%20custom%20Data%20Entities%20for%20Dual-write"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Develop custom Data Entities for Dual-write on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnuxulu.com%2fposts%2f2021-05-02-develop-custom-data-entities-for-dual-write%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Develop custom Data Entities for Dual-write on whatsapp" href="https://api.whatsapp.com/send?text=Develop%20custom%20Data%20Entities%20for%20Dual-write%20-%20https%3a%2f%2fnuxulu.com%2fposts%2f2021-05-02-develop-custom-data-entities-for-dual-write%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Develop custom Data Entities for Dual-write on telegram" href="https://telegram.me/share/url?text=Develop%20custom%20Data%20Entities%20for%20Dual-write&url=https%3a%2f%2fnuxulu.com%2fposts%2f2021-05-02-develop-custom-data-entities-for-dual-write%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://nuxulu.com>Dynamics 365 Finance Operations & Power Platform</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>